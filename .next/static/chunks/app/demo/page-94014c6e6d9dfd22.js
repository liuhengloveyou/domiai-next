(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[436],{2962:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(97009).A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]])},63811:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(6658),n=r(39242),i=r(99543),s=r(38503);function l(e){let{className:t,defaultValue:r,value:l,min:d=0,max:c=100,...o}=e,u=n.useMemo(()=>Array.isArray(l)?l:Array.isArray(r)?r:[d,c],[l,r,d,c]);return(0,a.jsxs)(i.bL,{"data-slot":"slider",defaultValue:r,value:l,min:d,max:c,className:(0,s.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...o,children:[(0,a.jsx)(i.CC,{"data-slot":"slider-track",className:(0,s.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,a.jsx)(i.Q6,{"data-slot":"slider-range",className:(0,s.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:u.length},(e,t)=>(0,a.jsx)(i.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}},73109:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>A,dynamic:()=>N});var a=r(6658),n=r(39242),i=r(85992),s=r(26650),l=r(63811),d=r(82530),c=r(94986),o=r(77916),u=r(97009);let h=(0,u.A)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var f=r(2962);let m=(0,u.A)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),g=(0,u.A)("type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),x=(0,u.A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),w=(0,u.A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),p=(0,u.A)("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),v=(0,u.A)("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);var y=r(82533),j=r(18822),k=r(46383),b=r(38503);let N="force-dynamic";function A(){let{t:e}=(0,k.o)(),[t,r]=(0,n.useState)(!1),u=(0,n.useRef)(null),[N,A]=(0,n.useState)(null),[S,D]=(0,n.useState)("select"),[z,C]=(0,n.useState)(5),[M,I]=(0,n.useState)("#000000"),[B,O]=(0,n.useState)(!1),[$,E]=(0,n.useState)(!1),L=(0,n.useRef)({states:[],currentStateIndex:-1}),R=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(console.log("mounted>>>>>>>>>>>>",t),r(!0),t&&u.current&&!N){let e=new j.Hl(u.current,{width:800,height:600,backgroundColor:"#ffffff",isDrawingMode:!1});return e.freeDrawingBrush=new j.mW(e),e.freeDrawingBrush.width=z,e.freeDrawingBrush.color=M,A(e),F(e),e.on("object:modified",()=>{F(e)}),e.on("object:added",()=>{F(e)}),e.on("object:removed",()=>{F(e)}),()=>{e.dispose()}}},[t]);let F=e=>{if(!e)return;let t=L.current,r=JSON.stringify(e.toJSON());t.currentStateIndex<t.states.length-1&&(t.states=t.states.slice(0,t.currentStateIndex+1)),t.states.push(r),t.currentStateIndex=t.states.length-1,O(t.currentStateIndex>0),E(!1)},J=e=>{N&&(D(e),"draw"===e?(N.isDrawingMode=!0,N.freeDrawingBrush&&(N.freeDrawingBrush.width=z),N.freeDrawingBrush&&(N.freeDrawingBrush.color=M)):N.isDrawingMode=!1)};return((0,n.useEffect)(()=>{if(!N)return;let e=()=>{let e=Math.min(window.innerWidth-40,1e3),t=Math.min(window.innerHeight-180,700);N.setDimensions({width:e,height:t},{backstoreOnly:!1})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[N]),(0,n.useEffect)(()=>{N&&N.isDrawingMode&&N.freeDrawingBrush&&(N.freeDrawingBrush.width=z,N.freeDrawingBrush.color=M)},[z,M,N,S]),t)?(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(c.j,{}),(0,a.jsx)("main",{children:(0,a.jsx)(s.Zp,{className:"backdrop-blur-sm bg-background/60 rounded-none border-none h-screen",children:(0,a.jsx)(s.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(i.$,{variant:"select"===S?"default":"outline",onClick:()=>J("select"),className:"flex items-center gap-2",children:[(0,a.jsx)(o.A,{size:16}),e("select")||"选择"]}),(0,a.jsxs)(i.$,{variant:"draw"===S?"default":"outline",onClick:()=>J("draw"),className:"flex items-center gap-2",children:[(0,a.jsx)(h,{size:16}),e("draw")||"绘制"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=new j.rw({left:100,top:100,fill:M,width:100,height:100,objectCaching:!1});N.add(e),N.setActiveObject(e)},className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{size:16}),e("rectangle")||"矩形"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=new j.jl({left:100,top:100,fill:M,radius:50,objectCaching:!1});N.add(e),N.setActiveObject(e)},className:"flex items-center gap-2",children:[(0,a.jsx)(m,{size:16}),e("circle")||"圆形"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=new j.DA("双击编辑文本",{left:100,top:100,fontFamily:"sans-serif",fill:M,fontSize:20,objectCaching:!1});N.add(e),N.setActiveObject(e)},className:"flex items-center gap-2",children:[(0,a.jsx)(g,{size:16}),e("text")||"文本"]}),(0,a.jsxs)(i.$,{variant:"outline",className:"flex items-center gap-2 cursor-pointer",onClick:()=>{var e;return null==(e=R.current)?void 0:e.click()},children:[(0,a.jsx)(x,{size:16}),e("image")||"图片",(0,a.jsx)("input",{ref:R,type:"file",accept:"image/*",className:"hidden",onChange:e=>{if(!N||!e.target.files||0===e.target.files.length)return;let t=e.target.files[0],r=new FileReader;r.onload=e=>{e.target&&j.Ng.fromURL(e.target.result).then(e=>{let t=.8*N.getWidth(),r=.8*N.getHeight();if(e.width>t||e.height>r){let a=Math.min(t/e.width,r/e.height);e.scale(a)}e.set({left:100,top:100}),N.add(e),N.setActiveObject(e),F(N)})},r.readAsDataURL(t),e.target.value=""}})]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=N.getActiveObjects();e.length>0&&(N.remove(...e),N.discardActiveObject(),N.requestRenderAll(),F(N))},className:"flex items-center gap-2 text-red-500 hover:text-red-700",children:[(0,a.jsx)(w,{size:16}),e("delete")||"删除"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=L.current;e.currentStateIndex>0&&(e.currentStateIndex--,N.loadFromJSON(e.states[e.currentStateIndex],N.renderAll.bind(N)),O(e.currentStateIndex>0),E(e.currentStateIndex<e.states.length-1))},disabled:!B,className:(0,b.cn)("flex items-center gap-2",!B&&"opacity-50 cursor-not-allowed"),children:[(0,a.jsx)(p,{size:16}),e("undo")||"撤销"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=L.current;e.currentStateIndex<e.states.length-1&&(e.currentStateIndex++,N.loadFromJSON(e.states[e.currentStateIndex],N.renderAll.bind(N)),O(e.currentStateIndex>0),E(e.currentStateIndex<e.states.length-1))},disabled:!$,className:(0,b.cn)("flex items-center gap-2",!$&&"opacity-50 cursor-not-allowed"),children:[(0,a.jsx)(v,{size:16}),e("redo")||"重做"]}),(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!N)return;let e=N.toDataURL({format:"png",quality:1,multiplier:1}),t=document.createElement("a");t.download="fabric-drawing-".concat(new Date().toISOString().slice(0,10),".png"),t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)},className:"flex items-center gap-2 ml-auto",children:[(0,a.jsx)(y.A,{size:16}),e("download")||"下载"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"brush-size",children:e("brushSize")||"画笔大小"}),(0,a.jsx)(l.A,{id:"brush-size",min:1,max:50,step:1,value:[z],onValueChange:e=>{if(!N)return;let t=e[0];C(t),N.isDrawingMode&&N.freeDrawingBrush&&(N.freeDrawingBrush.width=t)},className:"mt-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"brush-color",children:e("brushColor")||"画笔颜色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("input",{id:"brush-color",type:"color",value:M,onChange:e=>{if(!N)return;let t=e.target.value;I(t),N.isDrawingMode&&N.freeDrawingBrush&&(N.freeDrawingBrush.color=t)},className:"w-10 h-10 rounded cursor-pointer"}),(0,a.jsx)("span",{className:"text-sm",children:M})]})]})]}),(0,a.jsx)("div",{className:"border border-primary/10 rounded-lg overflow-hidden",children:(0,a.jsx)("canvas",{ref:u,className:"w-full max-w-full"})})]})})})})]}):null}},77916:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(97009).A)("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]])},82533:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(97009).A)("download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},85796:(e,t,r)=>{Promise.resolve().then(r.bind(r,73109))}},e=>{var t=t=>e(e.s=t);e.O(0,[520,181,889,617,543,383,197,773,261,358],()=>t(85796)),_N_E=e.O()}]);