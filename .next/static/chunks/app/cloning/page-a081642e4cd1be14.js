(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{1371:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>F});var s=a(6658),t=a(39242),i=a(85992),o=a(59994),n=a(56560),l=a(63811),c=a(82530),d=a(26650),m=a(35728),u=a(2962);let p=(0,a(97009).A)("mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var h=a(93376),x=a(97937),v=a(18595),g=a(82533),y=a(46383),j=a(14232),b=a(94986),f=a(3184),N=a(75367),w=a(9088),k=a(82999),C=a(31054),R=a(38503),E=a(85904),S=a(9388);let V=[{code:"zh-CN",nameKey:"chinese"},{code:"en-US",nameKey:"english"},{code:"ja-JP",nameKey:"japanese"},{code:"ko-KR",nameKey:"korean"},{code:"es-ES",nameKey:"spanish"},{code:"fr-FR",nameKey:"french"},{code:"ru-RU",nameKey:"russian"},{code:"it-IT",nameKey:"italian"},{code:"pt-PT",nameKey:"portuguese"},{code:"de-DE",nameKey:"german"},{code:"vi-VN",nameKey:"vietnamese"},{code:"uk-UA",nameKey:"ukrainian"},{code:"tr-TR",nameKey:"turkish"},{code:"id-ID",nameKey:"indonesian"},{code:"ar-SA",nameKey:"arabic"}],A={minimax:1e4};function F(){let{t:e}=(0,y.o)(),[r,a]=(0,t.useState)(""),[F,U]=(0,t.useState)("zh-CN"),[K]=(0,t.useState)(1),[D,P]=(0,t.useState)(!1),[T]=(0,t.useState)(null),[I,W]=(0,t.useState)(!1),{data:Z}=(0,w.wV)(),[z,L]=(0,t.useState)(null),[O,Q]=(0,t.useState)(!1),$=(0,k.s)(),[_,q]=(0,t.useState)(null),[B,J]=(0,t.useState)(!1),M=(0,t.useRef)(null),[G,H]=(0,t.useState)(!1),[X,Y]=(0,t.useState)(null),ee=(0,E.useRouter)(),er={uploadAudioFirst:e("uploadAudioFirst"),audioUploadRequirements:e("audioUploadRequirements"),loginRequired:e("loginRequired"),loginForCloning:e("loginForCloning"),fetchUserDataError:e("fetchUserDataError"),insufficientCloneCredits:e("insufficientCloneCredits"),buyMoreCredits:e("buyMoreCredits"),startCloningTitle:e("startCloningTitle"),startCloningDesc:e("startCloningDesc"),cloneVoiceFailed:e("cloneVoiceFailed"),invalidVoiceId:e("invalidVoiceId"),cloneSuccess:e("cloneSuccess"),cloneReadyToUse:e("cloneReadyToUse"),cloneError:e("cloneError"),unknownError:e("unknownError"),invalidResponse:e("invalidResponse")||"Invalid response from server"},ea={...er,error:e("error"),fetchCloneVoicesError:e("fetchCloneVoicesError"),deleteSuccess:e("deleteSuccess"),cloneVoiceDeleted:e("cloneVoiceDeleted"),deleteCloneVoiceError:e("deleteCloneVoiceError"),recordingComplete:e("recordingComplete"),recordingSaved:(r,a)=>e("recordingSaved",{filename:r,size:a}),startRecordingTitle:e("startRecordingTitle"),startRecordingDesc:e("startRecordingDesc"),microphoneAccessError:e("microphoneAccessError"),clonedVoice:e("clonedVoice")};(0,t.useEffect)(()=>{P(!0);let r=localStorage.getItem("clonedVoiceId");r&&L({id:r,gender:"Female",provider:"minimax",name:e("clonedVoice")})},[]);let es=async()=>{if(!O)try{Q(!0)}catch(r){console.error(e("speechSynthesisError"),r),(0,S.oR)(r instanceof Error?r.message:e("speechError"))}finally{Q(!1)}},et=async()=>{try{if(!r)return void(0,S.oR)(e("pleaseEnterText"));if(!z)return void(0,S.oR)(e("selectVoiceFirst"));if(!(null==Z?void 0:Z.user))return}catch(r){console.error(e("downloadError"),r)}},ei=async e=>{var r;let s=null==(r=e.target.files)?void 0:r[0];if(s)try{if("text/plain"===s.type||s.name.endsWith(".txt")||s.name.endsWith(".md")){let e=new FileReader;e.onload=e=>{var r;let s=null==(r=e.target)?void 0:r.result;a(s)},e.readAsText(s)}else"application/pdf"===s.type||s.type.includes("word")||s.name.endsWith(".doc")||s.name.endsWith(".docx")||s.name.endsWith(".rtf")}catch(e){console.error("File upload error:",e)}},eo=()=>{T&&(T.audioContext.suspend(),W(!1))},en=()=>{T&&(T.audioContext.resume(),W(!0))},el=async r=>{var a;let s=null==(a=r.target.files)?void 0:a[0];if(s)try{if(!s.type.startsWith("audio/")||s.size>0x1400000)return;let r=new Audio,a=await new Promise((a,t)=>{r.onloadedmetadata=()=>a(r.duration),r.onerror=()=>t(Error(e("audioDurationError"))),r.src=URL.createObjectURL(s)});if(a<10||a>300)return void URL.revokeObjectURL(r.src);q(s),URL.revokeObjectURL(r.src)}catch(r){console.error(e("uploadError"),r)}},ec=async()=>{try{let e=await fetch("/api/voice/cloned-voices");if(401===e.status||404===e.status)return;let r=await e.json();Array.isArray(r)}catch(e){}},ed=async()=>{if(_){if(!(null==Z?void 0:Z.user))return void ee.push("/auth/login");try{let e=await fetch("/api/user/plan");if(!e.ok)throw Error(er.fetchUserDataError);let r=await e.json();if(!r.cloneQuota||r.cloneQuota.remaining_clones<=0)return void ee.push("/pricing?type=clone")}catch(e){console.error(er.fetchUserDataError,e);return}try{let e;J(!0);let r=new FormData;r.append("audio",_);let a=await fetch("/api/voice/clone",{method:"POST",body:r});if(!a.ok){let e=er.cloneVoiceFailed;try{let r=a.headers.get("content-type");if(r&&r.includes("application/json")){let r=await a.json();r.error&&(e=r.error)}else{let e=await a.text();console.error("非JSON错误响应:",e.substring(0,200)+"...")}}catch(e){console.error("解析错误响应失败:",e)}throw Error(e)}try{e=await a.json()}catch(e){throw console.error("解析JSON响应失败:",e),Error(er.invalidResponse)}if(!e.voiceId)throw Error(er.invalidVoiceId);await ec();let s={id:e.savedVoice.voiceId,gender:"Female",provider:"minimax",name:e.savedVoice.name};L(s),em()}catch(e){console.error(er.cloneError,e)}finally{J(!1)}}},em=()=>{q(null),M.current&&(M.current.value="")},eu=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(e),a=[];r.ondataavailable=e=>{e.data.size>0&&a.push(e.data)},r.onstop=()=>{let e=new Blob(a,{type:"audio/wav"}),r=new File([e],"recording-".concat(Date.now(),".wav"),{type:"audio/wav"});q(r)},r.start(),Y(r),H(!0)}catch(e){console.error(ea.error,e)}};return D?(0,s.jsxs)("div",{className:"min-h-screen",children:[(0,s.jsx)(b.j,{}),(0,s.jsx)("main",{className:"container mx-auto px-4 py-4 md:py-8 space-y-4 md:space-y-8",children:(0,s.jsxs)(d.Zp,{className:"backdrop-blur-sm bg-background/80 border-primary/10 shadow-lg",children:[(0,s.jsx)(d.aR,{className:"border-b border-primary/10 pb-4 md:pb-6",children:(0,s.jsx)(d.ZB,{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent text-center",children:e("voiceCloning")})}),(0,s.jsx)(d.Wu,{className:"pt-4 md:pt-6",children:(0,s.jsxs)("div",{className:"space-y-4 md:space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)(d.Zp,{className:"backdrop-blur-sm bg-background/80 border-primary/10 shadow-md",children:[(0,s.jsx)(d.aR,{className:"space-y-1 md:space-y-2",children:(0,s.jsx)(d.ZB,{className:"text-lg md:text-xl bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:e("uploadAudio")})}),(0,s.jsx)(d.Wu,{className:"space-y-3 md:space-y-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(N.Q,{children:(0,s.jsxs)(i.$,{variant:"outline",onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},disabled:B||G,className:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 h-10",children:[(0,s.jsx)(m.A,{className:"w-4 h-4 mr-2"}),e("uploadAudio")]})}),(0,s.jsx)(N.Q,{children:(0,s.jsx)(i.$,{variant:"outline",onClick:G?()=>{X&&G&&(X.stop(),X.stream.getTracks().forEach(e=>e.stop()),H(!1),Y(null))}:eu,disabled:B,className:(0,R.cn)("bg-gradient-to-r text-white h-10",G?"from-red-500 to-red-600 hover:from-red-600 hover:to-red-700":"from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600"),children:G?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"w-4 h-4 mr-2"}),e("stopRecording")]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p,{className:"w-4 h-4 mr-2"}),e("record")]})})})]}),_&&(0,s.jsx)("div",{className:"text-sm text-gray-500 bg-muted/30 p-2 rounded-lg",children:e("fileSelected",{filename:_.name,size:(_.size/1024/1024).toFixed(2)})}),(0,s.jsx)("input",{type:"file",ref:M,className:"hidden",accept:"audio/*",onChange:el}),(0,s.jsx)(i.$,{className:"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 h-10 text-white hover:from-blue-600 hover:via-purple-600 hover:to-pink-600",onClick:ed,disabled:!_||B||G,children:B?e("cloning"):e("startCloning")}),z&&(0,s.jsx)("div",{className:"p-2 bg-muted/30 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-sm",children:[e("voiceId"),z.id]}),(0,s.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{localStorage.removeItem("clonedVoiceId"),L(null)},className:"text-red-500 hover:text-red-600",children:e("clear")})]})})]})})]}),(0,s.jsxs)(d.Zp,{className:"backdrop-blur-sm bg-background/80 border-primary/10 shadow-md",children:[(0,s.jsx)(d.aR,{className:"space-y-1 md:space-y-2",children:(0,s.jsx)(d.ZB,{className:"text-lg md:text-xl bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:e("instructions")})}),(0,s.jsx)(d.Wu,{children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,s.jsx)("p",{children:e("instruction1")}),(0,s.jsx)("p",{children:e("instruction2")}),(0,s.jsx)("p",{children:e("instruction3")}),(0,s.jsx)("p",{children:e("instruction4")}),(0,s.jsx)("p",{children:e("instruction5")}),(0,s.jsx)("p",{children:e("instruction6")}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-primary/10",children:(0,s.jsx)("p",{className:"text-xs text-red-500",children:e("legalNotice")})})]})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)(d.Zp,{className:"backdrop-blur-sm bg-background/80 border-primary/10 shadow-md",children:[(0,s.jsx)(d.aR,{className:"space-y-1 md:space-y-2",children:(0,s.jsx)(d.ZB,{className:"text-lg md:text-xl bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:e("serviceSettings")})}),(0,s.jsx)(d.Wu,{className:"space-y-3 md:space-y-4",children:(0,s.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5 md:space-y-2",children:[(0,s.jsx)(c.J,{children:e("selectLanguage")}),(0,s.jsxs)(n.l6,{value:F,onValueChange:e=>{U(e),$.trackEvent("change_language","settings",e)},children:[(0,s.jsx)(n.bq,{className:"h-10",children:(0,s.jsx)(n.yv,{})}),(0,s.jsx)(n.gC,{className:"max-h-[40vh] overflow-y-auto",children:V.map(r=>(0,s.jsx)(n.eb,{value:r.code,children:e(r.nameKey)},r.code))})]})]}),(0,s.jsxs)("div",{className:"space-y-1.5 md:space-y-2",children:[(0,s.jsx)(c.J,{children:e("voice")}),F&&(0,s.jsx)(C.E,{languageCode:F,onVoiceSelect:L,selectedVoiceId:null==z?void 0:z.id,provider:"minimax"})]}),(0,s.jsxs)("div",{className:"space-y-1.5 md:space-y-2",children:[(0,s.jsxs)(c.J,{children:[e("speed"),": ",K,"x"]}),(0,s.jsx)(l.A,{value:[K],min:.5,max:2,step:.1,className:"py-1"})]})]})})]}),(0,s.jsxs)(d.Zp,{className:"backdrop-blur-sm bg-background/80 border-primary/10 shadow-md",children:[(0,s.jsx)(d.aR,{className:"space-y-1 md:space-y-2",children:(0,s.jsx)(d.ZB,{className:"text-lg md:text-xl bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:e("readText")})}),(0,s.jsxs)(d.Wu,{className:"space-y-3 md:space-y-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(o.T,{placeholder:e("inputPlaceholder"),className:"min-h-[120px] md:min-h-[200px] bg-background/70 backdrop-blur-sm border-primary/20 focus:border-primary/40 transition-all duration-300 resize-none text-sm md:text-base",value:r,maxLength:A.minimax}),(0,s.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:[r.length,"/",A.minimax.toLocaleString()," ",e("characters")]})]}),T&&(0,s.jsx)(f.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"w-full",children:(0,s.jsx)(j.t,{audioContext:T.audioContext,audioSource:T.source,onPause:eo,onResume:en,isPlaying:I})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)(N.Q,{children:(0,s.jsxs)(i.$,{onClick:es,className:"flex-1 h-10 text-sm bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 transition-all duration-300",children:[(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4"}),e("readText")]})}),T&&(0,s.jsx)(f.P.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},children:(0,s.jsx)(N.Q,{children:(0,s.jsx)(i.$,{variant:"outline",size:"icon",onClick:I?eo:en,className:"h-10 w-10 border-primary/20 hover:border-primary/40",children:I?(0,s.jsx)(x.A,{className:"h-4 w-4"}):(0,s.jsx)(v.A,{className:"h-4 w-4"})})})}),(0,s.jsx)(N.Q,{children:(0,s.jsxs)(i.$,{variant:"outline",onClick:et,className:"flex-1 h-10 text-sm border-primary/20 hover:border-primary/40 hover:bg-primary/5",children:[(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4"}),e("downloadAudio")]})}),(0,s.jsx)(N.Q,{children:(0,s.jsx)(i.$,{variant:"outline",className:"flex-1 h-10 text-sm border-primary/20 hover:border-primary/40 hover:bg-primary/5",asChild:!0,children:(0,s.jsxs)("label",{children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4"}),e("uploadFile"),(0,s.jsx)("input",{type:"file",className:"hidden",accept:".txt,.md",onChange:ei})]})})})]})]})]})]})]})})]})})]}):null}},2962:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(97009).A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]])},85904:(e,r,a)=>{"use strict";var s=a(51072);a.o(s,"usePathname")&&a.d(r,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(r,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(r,{useSearchParams:function(){return s.useSearchParams}})},90637:(e,r,a)=>{Promise.resolve().then(a.bind(a,1371))}},e=>{var r=r=>e(e.s=r);e.O(0,[889,890,613,184,543,383,197,548,773,261,358],()=>r(90637)),_N_E=e.O()}]);