(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[292],{9921:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j,dynamic:()=>v});var a=r(6658),n=r(85992),i=r(39242),l=r(94986),s=r(18822),o=r(70110),c=r(77916),d=r(26796),u=r(9388),h=r(63811),f=r(46874),g=r(38503);function p(e){let{delayDuration:t=0,...r}=e;return(0,a.jsx)(f.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function m(e){let{...t}=e;return(0,a.jsx)(p,{children:(0,a.jsx)(f.bL,{"data-slot":"tooltip",...t})})}function x(e){let{...t}=e;return(0,a.jsx)(f.l9,{"data-slot":"tooltip-trigger",...t})}function w(e){let{className:t,sideOffset:r=0,children:n,...i}=e;return(0,a.jsx)(f.ZL,{children:(0,a.jsxs)(f.UC,{"data-slot":"tooltip-content",sideOffset:r,className:(0,g.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...i,children:[n,(0,a.jsx)(f.i3,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}let v="force-dynamic";function j(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null),[r,f]=(0,i.useState)(!1),g=(0,i.useRef)(null),v=(0,i.useRef)(null),[j,b]=(0,i.useState)("https://picsum.photos/1920/1080"),[y,M]=(0,i.useState)("select"),[A,k]=(0,i.useState)(!1),R=(0,i.useRef)(new Map),C=(0,i.useRef)(new Map),S=(0,i.useRef)(null),[z,N]=(0,i.useState)(1),O=(0,i.useRef)(1),[E,D]=(0,i.useState)(!1),F=(0,i.useRef)(new Map),L=(0,i.useRef)({states:[],currentStateIndex:-1});(0,i.useEffect)(()=>{if(f(!0),r&&e.current&&!t.current){let r=new s.Hl(e.current,{width:window.innerWidth,height:window.innerHeight-64});t.current=r,r.on("object:moving",function(e){let t=e.target;if(t&&(C.current.forEach((e,r)=>{r===t&&(null!==e&&(cancelAnimationFrame(e),C.current.delete(r)),R.current.forEach((e,r)=>{e===t&&R.current.delete(r)}),0===C.current.size&&k(!1))}),F.current.has(t))){let e=F.current.get(t);null!==e&&cancelAnimationFrame(e),F.current.delete(t),0===F.current.size&&D(!1)}}),r.on("path:created",function(e){e.path.set({selectable:!1,evented:!1}),M("select"),r.isDrawingMode=!1;let t=S.current;if(t)R.current.set(e.path,t),H(e.path,t),console.log("使用保存的选中对象开始动画"),S.current=null;else{let t=r.getActiveObject();t?(R.current.set(e.path,t),H(e.path,t)):u.oR.warning("请先选中一个图片")}});let a=()=>{if(!r)return;let e=r.getActiveObject();r.getObjects().forEach(t=>{var r,a;if(t===e&&(null==(r=t.data)?void 0:r.isJumping)){let e=10*Math.sin(Date.now()/200);void 0!==t.data.lastTop&&Math.abs(t.top-t.data.lastTop-t.data.jumpOffset)>1&&(t.data.originalTop=t.top-t.data.jumpOffset);let r=t.data.originalTop+e;t.data.jumpOffset=e,t.data.lastTop=r,t.set("top",r),t.setCoords()}else(null==(a=t.data)?void 0:a.isJumping)&&"number"==typeof t.data.originalTop&&(t.set("top",t.data.originalTop),t.setCoords())}),r.renderAll(),requestAnimationFrame(a)};a(),r.freeDrawingBrush=new s.mW(r),r.freeDrawingBrush.width=1,r.freeDrawingBrush.color="#000000",T(r);let n=()=>{let e=window.innerWidth,t=window.innerHeight-64;r.setDimensions({width:e,height:t},{backstoreOnly:!1})};return n(),window.onresize=n,()=>{window.onresize=null,t.current&&(t.current.dispose(),t.current=null)}}},[r]);let T=e=>{if(!e)return;let t=L.current,r=JSON.stringify(e.toJSON());t.currentStateIndex<t.states.length-1&&(t.states=t.states.slice(0,t.currentStateIndex+1)),t.states.push(r),t.currentStateIndex=t.states.length-1},W=()=>{if(C.current.forEach(e=>{null!==e&&cancelAnimationFrame(e)}),C.current.clear(),R.current.clear(),0===C.current.size&&k(!1),t.current){let e=t.current;e.getObjects("path").forEach(t=>e.remove(t)),e.renderAll()}},H=(e,r)=>{if(!t.current||!e)return;let a=t.current,n=r||R.current.get(e);if(!n)return void u.oR.warning("请选中要运动的图片");let i=e.path;if(!i||0===i.length)return;e.set({opacity:0}),a.renderAll();let l=[],s=0,o=0;if(i.forEach(e=>{if("M"===e[0]||"L"===e[0])s=e[1],o=e[2],l.push({x:s,y:o});else if("Q"===e[0]){let t=s,r=o,a=e[1],n=e[2],i=e[3],c=e[4];for(let e=0;e<=1;e+=.05){let s=Math.pow(1-e,2)*t+2*(1-e)*e*a+Math.pow(e,2)*i,o=Math.pow(1-e,2)*r+2*(1-e)*e*n+Math.pow(e,2)*c;l.push({x:s,y:o})}s=i,o=c}else if("C"===e[0]){let t=s,r=o,a=e[1],n=e[2],i=e[3],c=e[4],d=e[5],u=e[6];for(let e=0;e<=1;e+=.05){let s=Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*a+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*d,o=Math.pow(1-e,3)*r+3*Math.pow(1-e,2)*e*n+3*(1-e)*Math.pow(e,2)*c+Math.pow(e,3)*u;l.push({x:s,y:o})}s=d,o=u}}),l.length>1){let e=[];for(let t=0;t<l.length-1;t++){let r=l[t],a=l[t+1];for(let t=0;t<=50;t++){let n=t/50;e.push({x:r.x+(a.x-r.x)*n,y:r.y+(a.y-r.y)*n})}}let t=[],r=e[0];t.push(r);let i=0;for(let a=1;a<e.length;a++){var c,d;(i+=(c=r,d=e[a],Math.hypot(c.x-d.x,c.y-d.y)))>=3&&(t.push(e[a]),r=e[a],i=0)}(0===t.length||t[t.length-1].x!==e[e.length-1].x||t[t.length-1].y!==e[e.length-1].y)&&t.push(e[e.length-1]);let s=0;k(!0);let o=()=>{if(s>=t.length){C.current.has(n)&&C.current.delete(n),0===C.current.size&&W();return}let e=t[s],r=n.getScaledWidth?n.getScaledWidth():n.width||0,i=n.getScaledHeight?n.getScaledHeight():n.height||0;n.set({left:e.x-r/2,top:e.y-i/2}),n.setCoords(),a.renderAll(),s+=O.current;let l=requestAnimationFrame(o);C.current.set(n,l)};o()}},_=()=>{if(!r||!t.current)return;let e=t.current,a=e.getActiveObject();if("draw"===y){M("select"),e.isDrawingMode=!1;return}if("select"===y){if(e.getObjects().length<=0)return void u.oR.warning("请先添加图片");if(!a)return void u.oR.warning("请先选择一个图片");let t=!1;if(C.current.forEach((e,r)=>{r===a&&(t=!0)}),t)return void u.oR.warning("该图片已经在动画中");S.current=a,M("draw"),e.isDrawingMode=!0,u.oR.warning("请为选中的图片绘制一条运动路径")}},q=()=>{if(!t.current)return;let e=t.current,r=e.getObjects().filter(e=>"image"===e.type&&!C.current.has(e));if(0===r.length)return void u.oR.warning("没有可用的图片进行随机运动");D(!0),u.oR.success("".concat(r.length,"张图片开始随机游荡")),r.forEach(t=>{let r=(1+2*Math.random())*(Math.random()>.5?1:-1);t.vx=(1+2*Math.random())*(Math.random()>.5?1:-1),t.vy=r;let a=()=>{if(!e.contains(t)){F.current.has(t)&&F.current.delete(t);return}let r=t.left||0,n=t.top||0,i=r+t.vx,l=n+t.vy,s=t.getScaledWidth?t.getScaledWidth():t.width||0,o=t.getScaledHeight?t.getScaledHeight():t.height||0;i<0?(i=0,t.vx=Math.abs(t.vx)):i+s>e.width&&(i=e.width-s,t.vx=-Math.abs(t.vx)),l<0?(l=0,t.vy=Math.abs(t.vy)):l+o>e.height&&(l=e.height-o,t.vy=-Math.abs(t.vy)),.01>Math.random()&&(t.vx=(1+2*Math.random())*(Math.random()>.5?1:-1),t.vy=(1+2*Math.random())*(Math.random()>.5?1:-1)),t.set({left:i,top:l}),t.setCoords();let c=requestAnimationFrame(a);F.current.set(t,c)},n=requestAnimationFrame(a);F.current.set(t,n)})},B=()=>{F.current.forEach(e=>{null!==e&&cancelAnimationFrame(e)}),F.current.clear(),D(!1),u.oR.info("随机运动已停止")};return(0,a.jsxs)("div",{className:"min-h-screen",style:{backgroundImage:"url(".concat(j,")"),backgroundSize:"cover",backgroundPosition:"center"},children:[(0,a.jsx)(l.j,{}),(0,a.jsxs)("main",{children:[(0,a.jsx)("div",{className:"overflow-hidden h-full w-full ".concat("draw"===y?"backdrop-blur-md bg-background/60":"transition-all"),children:(0,a.jsx)("canvas",{ref:e,className:"w-full max-w-full h-full"})}),(0,a.jsxs)("div",{className:"absolute bottom-20 right-4 z-10 flex flex-col space-y-2 items-end",children:[(0,a.jsxs)(p,{children:[(0,a.jsxs)(m,{children:[(0,a.jsx)(x,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"default",size:"icon",className:"bg-gradient-to-r from-pink-500 via-orange-500 to-fuchsia-500",onClick:()=>_(),children:(0,a.jsx)(o.A,{})})}),(0,a.jsx)(w,{children:(0,a.jsx)("p",{children:"draw"===y?"退出绘图模式":"开始动画"})})]}),(0,a.jsxs)(m,{children:[(0,a.jsx)(x,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"default",size:"icon",className:E?"bg-red-500":"bg-blue-500",onClick:()=>{E?B():q()},children:(0,a.jsx)(c.A,{})})}),(0,a.jsx)(w,{children:(0,a.jsx)("p",{children:E?"停止随机运动":"开始随机运动"})})]}),(0,a.jsxs)(m,{children:[(0,a.jsx)(x,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"default",size:"icon",onClick:()=>{var e;return null==(e=g.current)?void 0:e.click()},children:[(0,a.jsx)(d.A,{}),(0,a.jsx)("input",{ref:g,type:"file",accept:"image/*",onChange:e=>{if(!e.target.files||!e.target.files[0]||!t.current)return;let r=e.target.files[0],a=new FileReader;a.onload=e=>{var r;if(!(null==(r=e.target)?void 0:r.result)||!t.current)return;let a=e.target.result;s.Ng.fromURL(a).then(e=>{e.width&&e.height&&(e.width>e.height?e.width>200&&e.scaleToWidth(200):e.height>200&&e.scaleToHeight(200));let r=t.current,a=Math.random()*(r.width-e.getScaledWidth()),n=Math.random()*(r.height-e.getScaledHeight());e.set({left:a,top:n,selectable:!0,evented:!0,hasBorders:!0,hasControls:!0,data:{isJumping:!0,originalTop:n}}),r.add(e)}).catch(e=>{console.error("Error loading image:",e)})},a.readAsDataURL(r),e.target.value=""},className:"hidden"})]})}),(0,a.jsx)(w,{children:(0,a.jsx)("p",{children:"上传图片"})})]}),(0,a.jsxs)(m,{children:[(0,a.jsx)(x,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"default",size:"icon",onClick:()=>{var e;return null==(e=v.current)?void 0:e.click()},children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),(0,a.jsx)("circle",{cx:"9",cy:"9",r:"2"}),(0,a.jsx)("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),(0,a.jsx)("input",{ref:v,type:"file",accept:"image/*",onChange:e=>{if(!e.target.files||!e.target.files[0])return;let t=e.target.files[0],r=new FileReader;r.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&(b(e.target.result),u.oR.success("背景已更新"))},r.readAsDataURL(t),e.target.value=""},className:"hidden"})]})}),(0,a.jsx)(w,{children:(0,a.jsx)("p",{children:"更换背景"})})]})]}),A&&(0,a.jsx)("div",{className:"pt-10",children:(0,a.jsx)(h.A,{min:1,max:20,step:2,value:[z],onValueChange:e=>{let[t]=e;N(t),O.current=t},className:"w-[200px]"})})]})]})]})}},63811:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(6658),n=r(39242),i=r(99543),l=r(38503);function s(e){let{className:t,defaultValue:r,value:s,min:o=0,max:c=100,...d}=e,u=n.useMemo(()=>Array.isArray(s)?s:Array.isArray(r)?r:[o,c],[s,r,o,c]);return(0,a.jsxs)(i.bL,{"data-slot":"slider",defaultValue:r,value:s,min:o,max:c,className:(0,l.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...d,children:[(0,a.jsx)(i.CC,{"data-slot":"slider-track",className:(0,l.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,a.jsx)(i.Q6,{"data-slot":"slider-range",className:(0,l.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:u.length},(e,t)=>(0,a.jsx)(i.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}},92158:(e,t,r)=>{Promise.resolve().then(r.bind(r,9921))}},e=>{var t=t=>e(e.s=t);e.O(0,[520,181,889,617,543,277,383,986,773,261,358],()=>t(92158)),_N_E=e.O()}]);