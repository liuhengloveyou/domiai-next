(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[292],{50316:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>o,av:()=>d,j7:()=>l,tU:()=>s});var r=a(6658);a(39242);var n=a(9908),i=a(38503);function s(e){let{className:t,...a}=e;return(0,r.jsx)(n.bL,{"data-slot":"tabs",className:(0,i.cn)("flex flex-col gap-2",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)(n.B8,{"data-slot":"tabs-list",className:(0,i.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)(n.l9,{"data-slot":"tabs-trigger",className:(0,i.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)(n.UC,{"data-slot":"tabs-content",className:(0,i.cn)("flex-1 outline-none",t),...a})}},63811:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(6658),n=a(39242),i=a(99543),s=a(38503);function l(e){let{className:t,defaultValue:a,value:l,min:o=0,max:d=100,...c}=e,u=n.useMemo(()=>Array.isArray(l)?l:Array.isArray(a)?a:[o,d],[l,a,o,d]);return(0,r.jsxs)(i.bL,{"data-slot":"slider",defaultValue:a,value:l,min:o,max:d,className:(0,s.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...c,children:[(0,r.jsx)(i.CC,{"data-slot":"slider-track",className:(0,s.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,r.jsx)(i.Q6,{"data-slot":"slider-range",className:(0,s.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:u.length},(e,t)=>(0,r.jsx)(i.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}},75219:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B,dynamic:()=>$});var r=a(6658),n=a(85992),i=a(39242),s=a(94986),l=a(18822),o=a(70110),d=a(77916),c=a(35673),u=a(27923),h=a(9388),f=a(63811),m=a(83616),g=a(38503);function x(e){let{delayDuration:t=0,...a}=e;return(0,r.jsx)(m.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...a})}function p(e){let{...t}=e;return(0,r.jsx)(x,{children:(0,r.jsx)(m.bL,{"data-slot":"tooltip",...t})})}function v(e){let{...t}=e;return(0,r.jsx)(m.l9,{"data-slot":"tooltip-trigger",...t})}function w(e){let{className:t,sideOffset:a=0,children:n,...i}=e;return(0,r.jsx)(m.ZL,{children:(0,r.jsxs)(m.UC,{"data-slot":"tooltip-content",sideOffset:a,className:(0,g.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...i,children:[n,(0,r.jsx)(m.i3,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}var b=a(12122);function j(e){let{...t}=e;return(0,r.jsx)(b._s.Root,{"data-slot":"drawer",...t})}function y(e){let{...t}=e;return(0,r.jsx)(b._s.Trigger,{"data-slot":"drawer-trigger",...t})}function N(e){let{...t}=e;return(0,r.jsx)(b._s.Portal,{"data-slot":"drawer-portal",...t})}function k(e){let{className:t,...a}=e;return(0,r.jsx)(b._s.Overlay,{"data-slot":"drawer-overlay",className:(0,g.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function M(e){let{className:t,children:a,...n}=e;return(0,r.jsxs)(N,{"data-slot":"drawer-portal",children:[(0,r.jsx)(k,{}),(0,r.jsxs)(b._s.Content,{"data-slot":"drawer-content",className:(0,g.cn)("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",t),...n,children:[(0,r.jsx)("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),a]})]})}function C(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"drawer-header",className:(0,g.cn)("flex flex-col gap-1.5 p-4",t),...a})}function R(e){let{className:t,...a}=e;return(0,r.jsx)(b._s.Title,{"data-slot":"drawer-title",className:(0,g.cn)("text-foreground font-semibold",t),...a})}var z=a(26650),A=a(50316),S=a(26796),O=a(86873),_=a(82283);function E(e){let{...t}=e;return(0,r.jsx)(_.bL,{"data-slot":"context-menu",...t})}function T(e){let{...t}=e;return(0,r.jsx)(_.l9,{"data-slot":"context-menu-trigger",...t})}function L(e){let{className:t,...a}=e;return(0,r.jsx)(_.ZL,{children:(0,r.jsx)(_.UC,{"data-slot":"context-menu-content",className:(0,g.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...a})})}function F(e){let{className:t,inset:a,variant:n="default",...i}=e;return(0,r.jsx)(_.q7,{"data-slot":"context-menu-item","data-inset":a,"data-variant":n,className:(0,g.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i})}var W=a(71172);function D(e){let{className:t,children:a,...n}=e;return(0,r.jsxs)(W.bL,{"data-slot":"scroll-area",className:(0,g.cn)("relative",t),...n,children:[(0,r.jsx)(W.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,r.jsx)(H,{}),(0,r.jsx)(W.OK,{})]})}function H(e){let{className:t,orientation:a="vertical",...n}=e;return(0,r.jsx)(W.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,g.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...n,children:(0,r.jsx)(W.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function q(e){let{onAddToCanvas:t,onChangeBackground:a}=e,s="authenticated"===status,l=(0,i.useRef)(null),o=(0,i.useRef)(null),[d,c]=(0,i.useState)([]),[u,f]=(0,i.useState)(!1),[m,g]=(0,i.useState)(!1);(0,i.useEffect)(()=>{m&&x()},[m]);let x=async()=>{console.log("fetchImageList 被调用");try{f(!0);let e=await fetch("/api/draw/img/list");if(!e.ok)throw Error("获取图片列表失败");let t=await e.json();c(t.data),console.log("图片列表:",t,d)}catch(e){console.error("获取图片列表出错:",e)}finally{f(!1)}},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img";if(!e.target.files||0===e.target.files.length)return;let a=Array.from(e.target.files),r=0,n=0;h.oR.info("开始上传 ".concat(a.length," 个文件...")),a.forEach(async e=>{try{let i=new FormData;i.append("method","drawgame/".concat(t)),i.append("file",e);let s=await fetch("/upimg",{method:"POST",body:i});if(!s.ok)return void n++;let l=await s.json();if(0!==l.code)return void n++;++r+n===a.length&&(n>0?h.oR.warning("上传完成：".concat(r," 个成功，").concat(n," 个失败")):h.oR.success("成功上传 ".concat(r," 个").concat("img"===t?"图片":"背景图")),await x())}catch(e){console.error("上传出错:",e),n++}}),e.target.value=""},v=e=>{try{let a="/tmpimgs"+e.path;t?t(a):h.oR.error("无法添加到画板")}catch(e){console.error("添加到画板出错:",e),h.oR.error("添加到画板失败")}},w=e=>{try{let t="/imgs"+e.path;a?a(t):h.oR.error("无法切换背景图")}catch(e){console.error("切换背景图出错:",e),h.oR.error("切换背景图失败")}},b=async e=>{try{if(!confirm("确定要删除这张图片吗？"))return;let t=await fetch("/api/draw/img/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})});if(!t.ok)throw Error("删除图片失败");let a=await t.json();0===a.code?(h.oR.success("图片已删除"),await x()):h.oR.error(a.msg||"删除失败")}catch(e){console.error("删除图片出错:",e),h.oR.error("删除图片失败")}};return(0,r.jsxs)(j,{direction:"right",open:m,onOpenChange:g,children:[(0,r.jsx)(y,{asChild:!0,children:(0,r.jsxs)(n.$,{variant:"default",children:[(0,r.jsx)(S.A,{}),"图库"]})}),(0,r.jsx)(M,{className:"w-[500px] max-w-[90vw]",children:(0,r.jsxs)("div",{className:"mx-auto w-full",children:[(0,r.jsxs)(C,{className:"relative",children:[(0,r.jsx)(R,{children:"图库"}),(0,r.jsx)(n.$,{variant:"outline",size:"icon",className:"absolute right-0 top-0",onClick:x,title:"刷新",children:(0,r.jsx)(O.A,{})})]}),(0,r.jsxs)(A.tU,{defaultValue:"pic",className:"w-[400px]",children:[(0,r.jsxs)(A.j7,{className:"grid w-full grid-cols-2",children:[(0,r.jsx)(A.Xi,{value:"pic",children:"动画图"}),(0,r.jsx)(A.Xi,{value:"bg",children:"背景图"})]}),(0,r.jsx)(A.av,{value:"pic",children:(0,r.jsxs)(z.Zp,{className:"border-0 shadow-none rounded-none",children:[(0,r.jsx)(z.Wu,{className:"px-2",children:u?(0,r.jsx)("div",{className:"text-center py-4",children:"加载中..."}):d.filter(e=>"img"===e.use).length>0?(0,r.jsx)(D,{className:"h-[calc(100vh-200px)] w-full rounded-none",children:(0,r.jsx)("div",{className:"grid grid-cols-3 gap-0",children:d.filter(e=>"img"===e.use).map((e,t)=>(0,r.jsxs)(E,{children:[(0,r.jsx)(T,{children:(0,r.jsx)("div",{className:"border rounded-md p-1 hover:border-primary cursor-pointer",children:(0,r.jsx)("img",{src:"/tmpimgs"+e.path,alt:e.name||"图片".concat(t),className:"w-full h-24 object-cover rounded"})})}),(0,r.jsxs)(L,{children:[(0,r.jsx)(F,{onClick:()=>v(e),children:"添加到画板"}),s&&(0,r.jsx)(F,{onClick:()=>b(e),className:"text-red-500 hover:text-red-700 hover:bg-red-100",children:"删除图片"})]})]},t))})}):(0,r.jsx)("div",{className:"text-center py-4",children:"暂无图片"})}),(0,r.jsxs)(z.wL,{className:"flex justify-end",children:[(0,r.jsxs)(n.$,{variant:"default",className:"w-full",onClick:()=>{var e;return null==(e=l.current)?void 0:e.click()},children:[(0,r.jsx)(S.A,{}),"添加图片"]}),(0,r.jsx)("input",{ref:l,type:"file",accept:"image/*",multiple:!0,onChange:e=>p(e,"img"),className:"hidden"})]})]})}),(0,r.jsx)(A.av,{value:"bg",children:(0,r.jsxs)(z.Zp,{className:"border-0 shadow-none",children:[(0,r.jsx)(z.Wu,{className:"space-y-2 px-2",children:u?(0,r.jsx)("div",{className:"text-center py-4",children:"加载中..."}):d.filter(e=>"bg"===e.use).length>0?(0,r.jsx)(D,{className:"h-[calc(100vh-200px)] w-full rounded-none",children:(0,r.jsx)("div",{className:"grid grid-cols-2 gap-0",children:d.filter(e=>"bg"===e.use).map((e,t)=>(0,r.jsxs)(E,{children:[(0,r.jsx)(T,{children:(0,r.jsx)("div",{className:"border rounded-md p-1 hover:border-primary cursor-pointer",children:(0,r.jsx)("img",{src:"/imgs"+e.path,alt:e.name||"图片".concat(t),className:"w-full h-24 object-cover rounded"})})}),(0,r.jsxs)(L,{children:[(0,r.jsx)(F,{onClick:()=>w(e),children:"切换背景图"}),s&&(0,r.jsx)(F,{onClick:()=>b(e),className:"text-red-500 hover:text-red-700 hover:bg-red-100",children:"删除图片"})]})]},t))})}):(0,r.jsx)("div",{className:"text-center py-4",children:"暂无背景图"})}),(0,r.jsxs)(z.wL,{className:"flex justify-end",children:[(0,r.jsxs)(n.$,{onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},className:"w-full",children:[(0,r.jsx)(S.A,{}),"添加背景图"]}),(0,r.jsx)("input",{ref:o,type:"file",accept:"image/*",multiple:!0,onChange:e=>p(e,"bg"),className:"hidden"})]})]})})]})]})})]})}let $="force-dynamic";function B(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null),[a,m]=(0,i.useState)(!1),[g,b]=(0,i.useState)("/images/583-1920x1080.jpg"),[j,y]=(0,i.useState)("select"),[N,k]=(0,i.useState)(!1),M=(0,i.useRef)(new Map),C=(0,i.useRef)(new Map),R=(0,i.useRef)(null),[z,A]=(0,i.useState)(1),S=(0,i.useRef)(1),[O,_]=(0,i.useState)(!1),E=(0,i.useRef)(new Map),[T,L]=(0,i.useState)(!1),F=(0,i.useRef)({states:[],currentStateIndex:-1});(0,i.useEffect)(()=>{if(m(!0),a&&e.current&&!t.current){let a=new l.Hl(e.current,{width:window.innerWidth,height:window.innerHeight-64});t.current=a,a.on("object:moving",function(e){let t=e.target;if(t&&(C.current.forEach((e,a)=>{a===t&&(null!==e&&(cancelAnimationFrame(e),C.current.delete(a)),M.current.forEach((e,a)=>{e===t&&M.current.delete(a)}),0===C.current.size&&k(!1))}),E.current.has(t))){let e=E.current.get(t);null!==e&&cancelAnimationFrame(e),E.current.delete(t),0===E.current.size&&_(!1)}}),a.on("path:created",function(e){e.path.set({selectable:!1,evented:!1}),y("select"),a.isDrawingMode=!1;let t=R.current;if(t)M.current.set(e.path,t),H(e.path,t),console.log("使用保存的选中对象开始动画"),R.current=null;else{let t=a.getActiveObject();t?(M.current.set(e.path,t),H(e.path,t)):h.oR.warning("请先选中一个图片")}});let r=()=>{if(!a)return;let e=a.getActiveObject();a.getObjects().forEach(t=>{var a,r;if(t===e&&(null==(a=t.data)?void 0:a.isJumping)){let e=10*Math.sin(Date.now()/200);void 0!==t.data.lastTop&&Math.abs(t.top-t.data.lastTop-t.data.jumpOffset)>1&&(t.data.originalTop=t.top-t.data.jumpOffset);let a=t.data.originalTop+e;t.data.jumpOffset=e,t.data.lastTop=a,t.set("top",a),t.setCoords()}else(null==(r=t.data)?void 0:r.isJumping)&&"number"==typeof t.data.originalTop&&(t.set("top",t.data.originalTop),t.setCoords())}),a.renderAll(),requestAnimationFrame(r)};r(),a.freeDrawingBrush=new l.mW(a),a.freeDrawingBrush.width=1,a.freeDrawingBrush.color="#000000",W(a);let n=()=>{let e=window.innerWidth,t=window.innerHeight-64;a.setDimensions({width:e,height:t},{backstoreOnly:!1})};return n(),window.onresize=n,()=>{window.onresize=null,t.current&&(t.current.dispose(),t.current=null)}}},[a]);let W=e=>{if(!e)return;let t=F.current,a=JSON.stringify(e.toJSON());t.currentStateIndex<t.states.length-1&&(t.states=t.states.slice(0,t.currentStateIndex+1)),t.states.push(a),t.currentStateIndex=t.states.length-1},D=()=>{if(C.current.forEach(e=>{null!==e&&cancelAnimationFrame(e)}),C.current.clear(),M.current.clear(),0===C.current.size&&k(!1),t.current){let e=t.current;e.getObjects("path").forEach(t=>e.remove(t)),e.renderAll()}},H=(e,a)=>{if(!t.current||!e)return;let r=t.current,n=a||M.current.get(e);if(!n)return void h.oR.warning("请选中要运动的图片");let i=e.path;if(!i||0===i.length)return;e.set({opacity:0}),r.renderAll();let s=[],l=0,o=0;if(i.forEach(e=>{if("M"===e[0]||"L"===e[0])l=e[1],o=e[2],s.push({x:l,y:o});else if("Q"===e[0]){let t=l,a=o,r=e[1],n=e[2],i=e[3],d=e[4];for(let e=0;e<=1;e+=.05){let l=Math.pow(1-e,2)*t+2*(1-e)*e*r+Math.pow(e,2)*i,o=Math.pow(1-e,2)*a+2*(1-e)*e*n+Math.pow(e,2)*d;s.push({x:l,y:o})}l=i,o=d}else if("C"===e[0]){let t=l,a=o,r=e[1],n=e[2],i=e[3],d=e[4],c=e[5],u=e[6];for(let e=0;e<=1;e+=.05){let l=Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*c,o=Math.pow(1-e,3)*a+3*Math.pow(1-e,2)*e*n+3*(1-e)*Math.pow(e,2)*d+Math.pow(e,3)*u;s.push({x:l,y:o})}l=c,o=u}}),s.length>1){let e=[];for(let t=0;t<s.length-1;t++){let a=s[t],r=s[t+1];for(let t=0;t<=50;t++){let n=t/50;e.push({x:a.x+(r.x-a.x)*n,y:a.y+(r.y-a.y)*n})}}let t=[],a=e[0];t.push(a);let i=0;for(let r=1;r<e.length;r++){var d,c;(i+=(d=a,c=e[r],Math.hypot(d.x-c.x,d.y-c.y)))>=3&&(t.push(e[r]),a=e[r],i=0)}(0===t.length||t[t.length-1].x!==e[e.length-1].x||t[t.length-1].y!==e[e.length-1].y)&&t.push(e[e.length-1]);let l=0;k(!0);let o=()=>{if(l>=t.length){C.current.has(n)&&C.current.delete(n),0===C.current.size&&D();return}let e=t[l],a=n.getScaledWidth?n.getScaledWidth():n.width||0,i=n.getScaledHeight?n.getScaledHeight():n.height||0;n.set({left:e.x-a/2,top:e.y-i/2}),n.setCoords(),r.renderAll(),l+=S.current;let s=requestAnimationFrame(o);C.current.set(n,s)};o()}},$=()=>{if(!a||!t.current)return;let e=t.current,r=e.getActiveObject();if("draw"===j){y("select"),e.isDrawingMode=!1;return}if("select"===j){if(e.getObjects().length<=0)return void h.oR.warning("请先添加图片");if(!r)return void h.oR.warning("请先选择一个图片");let t=!1;if(C.current.forEach((e,a)=>{a===r&&(t=!0)}),t)return void h.oR.warning("该图片已经在动画中");R.current=r,y("draw"),e.isDrawingMode=!0,h.oR.warning("请为选中的图片绘制一条运动路径")}},B=()=>{if(!t.current)return;let e=t.current,a=e.getObjects().filter(e=>"image"===e.type&&!C.current.has(e));if(0===a.length)return void h.oR.warning("没有可用的图片进行随机运动");_(!0),h.oR.success("".concat(a.length,"张图片开始随机游荡")),a.forEach(t=>{let a=(1+2*Math.random())*(Math.random()>.5?1:-1);t.vx=(1+2*Math.random())*(Math.random()>.5?1:-1),t.vy=a;let r=()=>{if(!e.contains(t)){E.current.has(t)&&E.current.delete(t);return}let a=t.left||0,n=t.top||0,i=a+t.vx,s=n+t.vy,l=t.getScaledWidth?t.getScaledWidth():t.width||0,o=t.getScaledHeight?t.getScaledHeight():t.height||0;i<0?(i=0,t.vx=Math.abs(t.vx)):i+l>e.width&&(i=e.width-l,t.vx=-Math.abs(t.vx)),s<0?(s=0,t.vy=Math.abs(t.vy)):s+o>e.height&&(s=e.height-o,t.vy=-Math.abs(t.vy)),.01>Math.random()&&(t.vx=(1+2*Math.random())*(Math.random()>.5?1:-1),t.vy=(1+2*Math.random())*(Math.random()>.5?1:-1)),t.set({left:i,top:s}),t.setCoords();let d=requestAnimationFrame(r);E.current.set(t,d)},n=requestAnimationFrame(r);E.current.set(t,n)})},I=()=>{E.current.forEach(e=>{null!==e&&cancelAnimationFrame(e)}),E.current.clear(),_(!1),h.oR.info("随机运动已停止")};return(0,r.jsxs)("div",{className:"min-h-screen w-full",style:{backgroundImage:"url(".concat(g,")"),backgroundSize:"100% 100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"100vh",width:"100vw"},children:[(0,r.jsx)(s.j,{}),(0,r.jsxs)("main",{children:[(0,r.jsx)("div",{className:"overflow-hidden h-full w-full ".concat("draw"===j?"backdrop-blur-md bg-background/60":"transition-all"),children:(0,r.jsx)("canvas",{ref:e,className:"w-full max-w-full h-full"})}),(0,r.jsx)("div",{className:"absolute bottom-10 left-4 z-10 flex flex-col space-y-2 items-end",children:N&&(0,r.jsx)("div",{className:"pt-10",children:(0,r.jsx)(f.A,{min:1,max:20,step:2,value:[z],onValueChange:e=>{let[t]=e;A(t),S.current=t},className:"w-[200px]"})})}),(0,r.jsxs)("div",{className:"absolute bottom-10 right-4 z-10 flex flex-col space-y-2 items-end",children:[(0,r.jsxs)(x,{children:[(0,r.jsxs)(p,{children:[(0,r.jsx)(v,{asChild:!0,children:(0,r.jsx)(n.$,{variant:"default",size:"icon",className:"bg-gradient-to-r from-pink-500 via-orange-500 to-fuchsia-500",onClick:()=>$(),children:(0,r.jsx)(o.A,{})})}),(0,r.jsx)(w,{children:(0,r.jsx)("p",{children:"draw"===j?"退出绘图模式":"开始动画"})})]}),(0,r.jsxs)(p,{children:[(0,r.jsx)(v,{asChild:!0,children:(0,r.jsx)(n.$,{variant:"default",size:"icon",className:O?"bg-red-500":"bg-blue-500",onClick:()=>{O?I():B()},children:(0,r.jsx)(d.A,{})})}),(0,r.jsx)(w,{children:(0,r.jsx)("p",{children:O?"停止随机运动":"开始随机运动"})})]}),(0,r.jsxs)(p,{children:[(0,r.jsx)(v,{asChild:!0,children:(0,r.jsx)(n.$,{variant:"outline",size:"icon",onClick:()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen().then(()=>{L(!1)}).catch(e=>{console.error("退出全屏错误: ".concat(e.message)),h.oR.error("无法退出全屏模式")}):document.documentElement.requestFullscreen().then(()=>{L(!0)}).catch(e=>{console.error("全屏切换错误: ".concat(e.message)),h.oR.error("无法进入全屏模式")})},className:"bg-white/80 backdrop-blur-sm",children:T?(0,r.jsx)(c.A,{}):(0,r.jsx)(u.A,{})})}),(0,r.jsx)(w,{children:(0,r.jsx)("p",{children:T?"退出全屏":"全屏显示"})})]})]}),(0,r.jsx)(q,{onAddToCanvas:e=>{if(!t.current)return;let a=t.current;l.Ng.fromURL(e).then(e=>{e.width&&e.height&&(e.width>e.height?e.width>200&&e.scaleToWidth(200):e.height>200&&e.scaleToHeight(200));let t=Math.random()*(a.width-e.getScaledWidth()),r=Math.random()*(a.height-e.getScaledHeight());e.set({left:t,top:r,selectable:!0,evented:!0,hasBorders:!0,hasControls:!0,data:{isJumping:!0,originalTop:r}}),a.add(e),a.setActiveObject(e),W(a)}).catch(e=>{console.error("加载图片失败:",e),h.oR.error("加载图片失败")})},onChangeBackground:e=>{b(e)}})]})]})]})}},92158:(e,t,a)=>{Promise.resolve().then(a.bind(a,75219))}},e=>{var t=t=>e(e.s=t);e.O(0,[520,889,890,613,543,346,383,197,773,261,358],()=>t(92158)),_N_E=e.O()}]);