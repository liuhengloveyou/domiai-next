(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[292],{9921:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v,dynamic:()=>w});var a=r(6658),n=r(85992),i=r(39242),l=r(94986),s=r(18822),o=r(70110),d=r(26796),c=r(9388),u=r(63811),h=r(46874),f=r(38503);function g(e){let{delayDuration:t=0,...r}=e;return(0,a.jsx)(h.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function p(e){let{...t}=e;return(0,a.jsx)(g,{children:(0,a.jsx)(h.bL,{"data-slot":"tooltip",...t})})}function m(e){let{...t}=e;return(0,a.jsx)(h.l9,{"data-slot":"tooltip-trigger",...t})}function x(e){let{className:t,sideOffset:r=0,children:n,...i}=e;return(0,a.jsx)(h.ZL,{children:(0,a.jsxs)(h.UC,{"data-slot":"tooltip-content",sideOffset:r,className:(0,f.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...i,children:[n,(0,a.jsx)(h.i3,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}let w="force-dynamic";function v(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null),[r,h]=(0,i.useState)(!1),f=(0,i.useRef)(null),w=(0,i.useRef)(null),[v,j]=(0,i.useState)("https://picsum.photos/1920/1080"),[b,y]=(0,i.useState)("select"),[k,M]=(0,i.useState)(null),[N,C]=(0,i.useState)(!1),A=(0,i.useRef)(void 0),S=(0,i.useRef)(null),[R,z]=(0,i.useState)(1),O=(0,i.useRef)(1),D=(0,i.useRef)({states:[],currentStateIndex:-1});(0,i.useEffect)(()=>{if(h(!0),r&&e.current&&!t.current){let r=new s.Hl(e.current,{width:window.innerWidth,height:window.innerHeight-64});t.current=r,r.on("path:created",function(e){e.path.set({selectable:!1,evented:!1}),M(e.path),y("select"),r.isDrawingMode=!1,r.add(e.path),console.log("?>>>>>>>>>>>>>>>>>>pathObj",k,A.current),A.current&&E(e.path)});let a=()=>{if(!r)return;let e=r.getActiveObject();r.getObjects().forEach(t=>{var r,a;if(t===e&&(null==(r=t.data)?void 0:r.isJumping)){let e=10*Math.sin(Date.now()/200);void 0!==t.data.lastTop&&Math.abs(t.top-t.data.lastTop-t.data.jumpOffset)>1&&(t.data.originalTop=t.top-t.data.jumpOffset);let r=t.data.originalTop+e;t.data.jumpOffset=e,t.data.lastTop=r,t.set("top",r),t.setCoords()}else(null==(a=t.data)?void 0:a.isJumping)&&"number"==typeof t.data.originalTop&&(t.set("top",t.data.originalTop),t.setCoords())}),r.renderAll(),requestAnimationFrame(a)};a(),r.freeDrawingBrush=new s.mW(r),r.freeDrawingBrush.width=1,r.freeDrawingBrush.color="#000000",L(r);let n=()=>{let e=window.innerWidth,t=window.innerHeight-64;r.setDimensions({width:e,height:t},{backstoreOnly:!1})};return n(),window.onresize=n,()=>{window.onresize=null,t.current&&(t.current.dispose(),t.current=null)}}},[r]);let L=e=>{if(!e)return;let t=D.current,r=JSON.stringify(e.toJSON());t.currentStateIndex<t.states.length-1&&(t.states=t.states.slice(0,t.currentStateIndex+1)),t.states.push(r),t.currentStateIndex=t.states.length-1},T=()=>{if(c.oR.info("动画已停止"),S.current&&(cancelAnimationFrame(S.current),S.current=null),A.current=void 0,C(!1),t.current){let e=t.current;e.getObjects("path").forEach(t=>e.remove(t)),M(null),e.renderAll()}},E=e=>{if(!t.current||!(e||k))return;let r=t.current;if(!A.current)return void c.oR.warning("请选中要运动的图片");let a=(e||k).path;if(!a||0===a.length)return;let n=[],i=0,l=0;if(a.forEach(e=>{if("M"===e[0]||"L"===e[0])i=e[1],l=e[2],n.push({x:i,y:l});else if("Q"===e[0]){let t=i,r=l,a=e[1],s=e[2],o=e[3],d=e[4];for(let e=0;e<=1;e+=.05){let i=Math.pow(1-e,2)*t+2*(1-e)*e*a+Math.pow(e,2)*o,l=Math.pow(1-e,2)*r+2*(1-e)*e*s+Math.pow(e,2)*d;n.push({x:i,y:l})}i=o,l=d}else if("C"===e[0]){let t=i,r=l,a=e[1],s=e[2],o=e[3],d=e[4],c=e[5],u=e[6];for(let e=0;e<=1;e+=.05){let i=Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*a+3*(1-e)*Math.pow(e,2)*o+Math.pow(e,3)*c,l=Math.pow(1-e,3)*r+3*Math.pow(1-e,2)*e*s+3*(1-e)*Math.pow(e,2)*d+Math.pow(e,3)*u;n.push({x:i,y:l})}i=c,l=u}}),n.length>1){let e=[];for(let t=0;t<n.length-1;t++){let r=n[t],a=n[t+1];for(let t=0;t<=50;t++){let n=t/50;e.push({x:r.x+(a.x-r.x)*n,y:r.y+(a.y-r.y)*n})}}let t=[],a=e[0];t.push(a);let i=0;for(let r=1;r<e.length;r++){var s,o;(i+=(s=a,o=e[r],Math.hypot(s.x-o.x,s.y-o.y)))>=3&&(t.push(e[r]),a=e[r],i=0)}(0===t.length||t[t.length-1].x!==e[e.length-1].x||t[t.length-1].y!==e[e.length-1].y)&&t.push(e[e.length-1]);let l=0;C(!0);let d=()=>{if(l>=t.length)return void T();let e=t[l],a=A.current,n=a.getScaledWidth?a.getScaledWidth():a.width||0,i=a.getScaledHeight?a.getScaledHeight():a.height||0;a.set({left:e.x-n/2,top:e.y-i/2}),a.setCoords(),r.renderAll(),l+=O.current,S.current=requestAnimationFrame(d)};d()}},W=()=>{if(!r||!t.current)return;let e=t.current;if(N)return void T();if(A.current=e.getActiveObject(),k&&A.current){y("select"),e.isDrawingMode=!1,E();return}if("draw"===b){y("select"),e.isDrawingMode=!1,T();return}if("select"===b){if(e.getObjects().length<=0)return void c.oR.warning("请先添加图片");y("draw"),e.isDrawingMode=!0,c.oR.warning("请先绘制一条运动路径")}};return(0,a.jsxs)("div",{className:"min-h-screen",style:{backgroundImage:"url(".concat(v,")"),backgroundSize:"cover",backgroundPosition:"center"},children:[(0,a.jsx)(l.j,{}),(0,a.jsxs)("main",{children:[(0,a.jsx)("div",{className:"overflow-hidden h-full w-full ".concat("draw"===b?"backdrop-blur-md bg-background/60":"transition-all"),children:(0,a.jsx)("canvas",{ref:e,className:"w-full max-w-full h-full"})}),(0,a.jsxs)("div",{className:"absolute bottom-20 right-4 z-10 flex flex-col space-y-2 items-end",children:[(0,a.jsxs)(g,{children:[(0,a.jsxs)(p,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"default",size:"icon",className:"".concat(N||"draw"===b?"bg-gradient-to-r from-pink-500 via-orange-500 to-fuchsia-500":""),onClick:()=>W(),children:(0,a.jsx)(o.A,{})})}),(0,a.jsx)(x,{children:(0,a.jsx)("p",{children:N?"停止动画":"draw"===b?"退出绘图模式":"开始动画"})})]}),(0,a.jsxs)(p,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"default",size:"icon",onClick:()=>{var e;return null==(e=f.current)?void 0:e.click()},children:[(0,a.jsx)(d.A,{}),(0,a.jsx)("input",{ref:f,type:"file",accept:"image/*",onChange:e=>{if(!e.target.files||!e.target.files[0]||!t.current)return;let r=e.target.files[0],a=new FileReader;a.onload=e=>{var r;if(!(null==(r=e.target)?void 0:r.result)||!t.current)return;let a=e.target.result;s.Ng.fromURL(a).then(e=>{e.width&&e.height&&(e.width>e.height?e.width>200&&e.scaleToWidth(200):e.height>200&&e.scaleToHeight(200));let r=t.current,a=Math.random()*(r.width-e.getScaledWidth()),n=Math.random()*(r.height-e.getScaledHeight());e.set({left:a,top:n,selectable:!0,evented:!0,hasBorders:!0,hasControls:!0,data:{isJumping:!0,originalTop:n}}),r.add(e)}).catch(e=>{console.error("Error loading image:",e)})},a.readAsDataURL(r),e.target.value=""},className:"hidden"})]})}),(0,a.jsx)(x,{children:(0,a.jsx)("p",{children:"上传图片"})})]}),(0,a.jsxs)(p,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"default",size:"icon",onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),(0,a.jsx)("circle",{cx:"9",cy:"9",r:"2"}),(0,a.jsx)("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),(0,a.jsx)("input",{ref:w,type:"file",accept:"image/*",onChange:e=>{if(!e.target.files||!e.target.files[0])return;let t=e.target.files[0],r=new FileReader;r.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&(j(e.target.result),c.oR.success("背景已更新"))},r.readAsDataURL(t),e.target.value=""},className:"hidden"})]})}),(0,a.jsx)(x,{children:(0,a.jsx)("p",{children:"更换背景"})})]})]}),N&&(0,a.jsx)("div",{className:"pt-10",children:(0,a.jsx)(u.A,{min:1,max:20,step:2,value:[R],onValueChange:e=>{let[t]=e;z(t),O.current=t},className:"w-[200px]"})})]})]})]})}},63811:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(6658),n=r(39242),i=r(99543),l=r(38503);function s(e){let{className:t,defaultValue:r,value:s,min:o=0,max:d=100,...c}=e,u=n.useMemo(()=>Array.isArray(s)?s:Array.isArray(r)?r:[o,d],[s,r,o,d]);return(0,a.jsxs)(i.bL,{"data-slot":"slider",defaultValue:r,value:s,min:o,max:d,className:(0,l.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...c,children:[(0,a.jsx)(i.CC,{"data-slot":"slider-track",className:(0,l.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,a.jsx)(i.Q6,{"data-slot":"slider-range",className:(0,l.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:u.length},(e,t)=>(0,a.jsx)(i.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}},92158:(e,t,r)=>{Promise.resolve().then(r.bind(r,9921))}},e=>{var t=t=>e(e.s=t);e.O(0,[520,181,889,617,543,950,383,986,773,261,358],()=>t(92158)),_N_E=e.O()}]);